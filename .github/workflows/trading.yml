name: Trading Bot BTC

on:
  schedule:
    # Ejecutar cada 3 horas (00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00 UTC)
    # En Colombia (UTC-5): 19:00, 22:00, 01:00, 04:00, 07:00, 10:00, 13:00, 16:00
    - cron: '0 0,3,6,9,12,15,18,21 * * *'
  workflow_dispatch:  # Permite ejecuci√≥n manual desde GitHub

jobs:
  run-trading-analysis:
    runs-on: ubuntu-latest
    timeout-minutes: 15  # Timeout de seguridad
    
    steps:
    - name: üîÑ Checkout c√≥digo
      uses: actions/checkout@v3
    
    - name: üêç Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: üì¶ Instalar dependencias
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ü§ñ Ejecutar an√°lisis de trading
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.8219822992:AAFTSaawrgdPcvyZ5QJ8bxSIPJ-eEFge6cQ }}
        TELEGRAM_CHAT_ID: ${{ secrets.805512543 }}
      run: |
        python mean_reversion.py
    
    - name: üìß Notificar si falla
      if: failure()
      run: |
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d text="‚ùå *ERROR: GitHub Actions*%0A%0AEl script de trading fall√≥. Revisa los logs en GitHub." \
          -d parse_mode="Markdown"
